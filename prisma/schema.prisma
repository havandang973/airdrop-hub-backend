generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Airdrop {
  id          Int       @id @default(autoincrement())
  name        String
  logo        String?
  description String?
  slug        String    @unique
  raise       Float?
  status      String?
  date        DateTime?
  createdBy   Int?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? 
  deletedAt   DateTime?

  // Quan hệ
  createdByUser User?   @relation("UserCreatedAirdrops", fields: [createdBy], references: [id])
  funds         AirdropFund[]
  tags          AirdropTag[]
  posts         AirdropPost[]

  @@map("airdrops")
}

model Funds {
  id          Int       @id @default(autoincrement())
  name        String
  logo        String?
  slug        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime?
  deletedAt   DateTime?

  // Quan hệ
  airdrops AirdropFund[]

  @@map("funds")
}

model AirdropFund {
  id         Int      @id @default(autoincrement())
  airdropId  Int
  fundId     Int

  airdrop Airdrop @relation(fields: [airdropId], references: [id])
  fund    Funds   @relation(fields: [fundId], references: [id])

  @@unique([airdropId, fundId])
  @@map("airdrop_funds")
}

model Tag {
  id        Int       @id @default(autoincrement())
  name      String
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  airdrops     AirdropTag[]
  airdropPosts AirdropPost[]
  postTags     PostTag[]

  @@map("tags")
}

model AirdropTag {
  id         Int      @id @default(autoincrement())
  airdropId  Int
  tagId      Int

  airdrop Airdrop @relation(fields: [airdropId], references: [id])
  tag     Tag     @relation(fields: [tagId], references: [id])

  @@unique([airdropId, tagId])
  @@map("airdrop_tags")
}

model AirdropPost {
  id         Int       @id @default(autoincrement())
  name       String
  status     String?
  date       DateTime?
  content    String?
  visibility Boolean   @default(true)
  pin        Boolean   @default(false)
  tagId      Int?
  createdBy  Int?
  airdropId  Int
  createdAt  DateTime  @default(now())
  updatedAt  DateTime?
  deletedAt  DateTime?

  createdByUser User?   @relation("UserCreatedAirdropPosts", fields: [createdBy], references: [id])
  tag           Tag?    @relation(fields: [tagId], references: [id])
  airdrop       Airdrop @relation(fields: [airdropId], references: [id])

  @@map("airdrop_posts")
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  role      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  createdAirdrops      Airdrop[]     @relation("UserCreatedAirdrops")
  createdAirdropPosts  AirdropPost[] @relation("UserCreatedAirdropPosts")
  createdPosts         Post[]        @relation("UserCreatedPosts")

  @@map("users")
}

model Category {
  id        Int       @id @default(autoincrement())
  name      String
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  posts Post[]

  @@map("categories")
}

model Post {
  id          Int       @id @default(autoincrement())
  title       String
  slug        String    @unique
  thumbnail   String?
  content     String?
  visibility  Boolean   @default(true)
  pin         Boolean   @default(false)
  categoryId  Int?
  createdBy   Int?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime?
  deletedAt   DateTime?

  category     Category?  @relation(fields: [categoryId], references: [id])
  createdByUser User?     @relation("UserCreatedPosts", fields: [createdBy], references: [id])
  postTags      PostTag[]

  @@map("posts")
}

model PostTag {
  id       Int   @id @default(autoincrement())
  postId   Int
  tagId    Int

  post Post @relation(fields: [postId], references: [id])
  tag  Tag  @relation(fields: [tagId], references: [id])

  @@unique([postId, tagId])
  @@map("post_tags")
}
